<!DOCTYPE HTML>
<html lang="zh-CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction</title>


        <!-- Custom HTML head -->

        <meta name="description" content="涵盖硬件接口、芯片设计、固件开发、内核协同、AI基础设施的全栈技术知识库">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ddr-introduction"><a class="header" href="#ddr-introduction">DDR Introduction</a></h1>
<p>[toc]</p>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>SDRAM vs. SRAM</p>
<ul>
<li>
<p>Synchronous Dynamic Random Access Memory</p>
</li>
<li>
<p>Static RAM</p>
</li>
</ul>
<p><img src="images/01_Introduction/image-20240725093325332.png" alt="image-20240725093325332" /></p>
<p>片内通常用SRAM，片外用SDRAM。</p>
<p><img src="images/01_Introduction/image-20240725103832027.png" alt="image-20240725103832027" /></p>
<h4 id="ddr3-sdram电路结构高清图"><a class="header" href="#ddr3-sdram电路结构高清图">DDR3 SDRAM电路结构高清图</a></h4>
<p><img src="images/01_Introduction/image-20240725094537472.png" alt="image-20240725094537472" /></p>
<ul>
<li>左上是命令信号，下面是地址，18b长度；</li>
<li>地址存到地址寄存器；</li>
<li>8个bank -&gt;  BA[2:0], 3个bit表示8个结果；</li>
<li>行选择，地址A，15b长度；</li>
<li>列选择，长度10b;</li>
<li>8192： 一行存储的电荷容量；</li>
</ul>
<p><strong>行地址（Row Address）</strong>：16位（A0-A15）</p>
<p><strong>列地址（Column Address）</strong>：10位（A0-A9）</p>
<p><strong>Bank地址（Bank Address）</strong>：3位（BA0-BA2）</p>
<p>4个时钟周期，上升下降都传输，8比特。</p>
<p><img src="images/01_Introduction/image-20240725101809984.png" alt="image-20240725101809984" /></p>
<p>256Mb Configuration</p>
<div class="table-wrapper"><table><thead><tr><th>参数</th><th>256Mb x 4</th><th>128Mb x 8</th><th>64Mb x 16</th></tr></thead><tbody>
<tr><td># of Banks</td><td>8</td><td>8</td><td>8</td></tr>
<tr><td>Bank Address</td><td>BA0 - BA2</td><td>BA0 - BA2</td><td>BA0 - BA2</td></tr>
<tr><td>Auto precharge</td><td>A10/AP</td><td>A10/AP</td><td>A10/AP</td></tr>
<tr><td>BC switch on the fly</td><td>A12/BC#</td><td>A12/BC#</td><td>A12/BC#</td></tr>
<tr><td>Row Address</td><td>A0 - A13</td><td>A0 - A13</td><td>A0 - A12</td></tr>
<tr><td>Column Address</td><td>A0 - A9,A11</td><td>A0 - A9</td><td>A0 - A9</td></tr>
<tr><td>Page size</td><td>1 KB</td><td>1 KB</td><td>2 KB</td></tr>
</tbody></table>
</div>
<p>2Gb Configuration</p>
<div class="table-wrapper"><table><thead><tr><th>参数</th><th>512Mb x 4</th><th>256Mb x 8</th><th>128Mb x 16</th></tr></thead><tbody>
<tr><td># of Banks</td><td>8</td><td>8</td><td>8</td></tr>
<tr><td>Bank Address</td><td>BA0 - BA2</td><td>BA0 - BA2</td><td>BA0 - BA2</td></tr>
<tr><td>Auto precharge</td><td>A10/AP</td><td>A10/AP</td><td>A10/AP</td></tr>
<tr><td>BC switch on the fly</td><td>A12/BC#</td><td>A12/BC#</td><td>A12/BC#</td></tr>
<tr><td>Row Address</td><td>A0 - A14</td><td>A0 - A14</td><td>A0 - A13</td></tr>
<tr><td>Column Address</td><td>A0 - A9,A11</td><td>A0 - A9</td><td>A0 - A9</td></tr>
<tr><td>Page size</td><td>1 KB</td><td>1 KB</td><td>2 KB</td></tr>
</tbody></table>
</div>
<h4 id="ddr4-sdram电路结构高清图"><a class="header" href="#ddr4-sdram电路结构高清图">DDR4 SDRAM电路结构高清图</a></h4>
<p><img src="images/01_Introduction/image-20240725095148736.png" alt="image-20240725095148736" /></p>
<p><strong>行地址（Row Address）</strong>：16位（A0-A15）</p>
<p><strong>列地址（Column Address）</strong>：10位（A0-A9）</p>
<p><strong>Bank地址（Bank Address）</strong>：2位（BA0-BA1）</p>
<p><strong>Bank组地址（Bank Group Address）</strong>：2位（BG0-BG1）</p>
<h4 id="ddr5-sdram电路结构高清图"><a class="header" href="#ddr5-sdram电路结构高清图">DDR5 SDRAM电路结构高清图</a></h4>
<p><img src="images/01_Introduction/image-20240725100117145.png" alt="image-20240725100117145" /></p>
<p><strong>行地址（Row Address）</strong>：16位（A0-A15）</p>
<p><strong>列地址（Column Address）</strong>：10位（A0-A9）</p>
<p><strong>Bank组地址（Bank Group Address）</strong>：2位（BA0-BA1）</p>
<p><strong>Bank地址（Bank Address）</strong>：3位（BG0-BG2）</p>
<p><strong>命令地址（Command Address）</strong>：统一使用CA总线</p>
<h2 id="存储层次"><a class="header" href="#存储层次">存储层次</a></h2>
<ol>
<li>Channel：处理器的内存控制器的通道数量</li>
<li>Module：内存条，可以有多个内存条连接到同一个 Channel 上</li>
<li>Rank：多个 DDR SDRAM 芯片在宽度上拼接起来，一个 Module 上可以放下一到四个 Rank，这些 Rank 共享总线，每个 Rank 都有自己的片选信号 CS_n，实际上就是在深度上拼接 SDRAM 芯片</li>
<li>Chip：也就是一个 DDR SDRAM 芯片，例如一个数据位宽是 64 位的 Rank，是使用 8 个 x8 的 Chip 在宽度上拼接而成</li>
<li>Bank Group：DDR4 引入，通过 Bank Group 掩盖 DDR4 同一个 Bank Group 内连续读的延迟 tCCD_L</li>
<li>Bank：每个 Bank 同时只有一个 Row 被激活，通过多个 Bank 掩盖 Activate/Precharge 的延迟</li>
<li>Row：Activate/Precharge 的单位</li>
<li>Column：每个 Column 保存 n 个 Cell，n 是 SDRAM 的位宽</li>
<li>Cell：每个 Cell 保存 1 bit 的数据</li>
</ol>
<h2 id="一些概念"><a class="header" href="#一些概念">一些概念</a></h2>
<h3 id="page的概念"><a class="header" href="#page的概念">Page的概念</a></h3>
<ul>
<li><strong>行（Row）和列（Column）</strong>：DDR内存被组织成一个二维数组，分为行和列。每个单元格存储一个位或几个位的数据。</li>
<li><strong>Page（页）</strong>：一次性可以被同时激活的行称为一页。当一行被激活后，内存控制器可以快速访问该行内的所有列数据，这样可以减少访问延迟。</li>
<li><strong>页大小</strong>：页的大小通常由行的宽度和列的宽度决定。例如，如果一行有1024个单元格，每个单元格存储一个字节，那么这一页的大小就是1024字节。</li>
</ul>
<p>为什么上面表格中有一个是2K page呢，因为它一行中1024个单元，但是是x16的，也就是2个B，所以是2KB。</p>
<h3 id="8n预取"><a class="header" href="#8n预取">8N预取</a></h3>
<p>内部总线是32位，外部是4位；8倍的关系，就是8N；</p>
<p>读操作，一下取32位，由并转串，发出去；</p>
<p>内部时钟是慢的，外部时钟是快的；</p>
<h2 id="内存训练"><a class="header" href="#内存训练">内存训练</a></h2>
<p>地址和控制信号使用的是菊花连，数据信号（DQ、DQS 和 DM）使用的是并行。</p>
<p><img src="images/01_Introduction/image-20240725110000495.png" alt="image-20240725110000495" /></p>
<p>fly-by的方式导致不同DRAM看到波形不同，有不同的延迟，越远延迟越大。需要在控制器侧加一些延迟，让数据对齐。</p>
<p>CLK/CLK#、DQS、AD和CMD信号不需要同时传递，改善了信号完整性，使更高频率成为可能。</p>
<p>DQ走的是并行。</p>
<p>地址行有效，列有效以后，第一颗芯片很快就准备好了数据，放到DQ上了，第8颗需要等很久才准备好。如果都准备好了，kua的一下，DQ去采样，就好了。就需要训练。</p>
<h3 id="write-leveling"><a class="header" href="#write-leveling">Write Leveling</a></h3>
<p>这部分解决 Fly-by Topology 带来的延迟不一致问题。</p>
<p>让 SDRAM 芯片接受到的 DQS 信号与 CK 信号同步。也就是确保所有数据线（DQ）和数据选通信号（DQS）在到达内存模块时是同步的。</p>
<p>DQS（Data Strobe）信号和CK（Clock）信号是关键的时钟和数据同步信号，用于确保数据的准确传输和接收。</p>
<p><strong>DQS信号</strong>：是数据选通信号，用于同步数据传输，确保数据在正确的时刻被锁存，用于在数据传输过程中指示数据有效时刻。它在读写操作中分别由内存模块和内存控制器生成，并与数据一起传输。</p>
<p><strong>CK信号</strong>：提供时钟基准，控制所有同步操作。数据在时钟信号的上升沿和下降沿都被传输，实现双倍数据速率。</p>
<p><strong>DQ信号</strong>：负责传输内存读写操作中的实际数据。每一条DQ信号线对应一个数据位。</p>
<p>简单来说，就是内存控制器不停的发送不同时延的DQS 信号，内存 颗粒在DQS-DQS#的上升沿采样CK 的状态，并通过DQ 线反馈给DDR3 控制器（一组01010101的数据）。控制器端反复的调整DQS-DQS#的延时，直到控制器端检测到DQ 线上0 到1 的跳变控制器就锁住此时的延时值，此时便完成了一个Write leveling过程。</p>
<p>过程：</p>
<ol>
<li>设置 SDRAM 进入 Write Leveling 模式，此时 SDRAM 会使用 DQS 对 CK 采样，把结果输出到 DQ</li>
<li>控制器枚举 DQS 的延迟，读取出每个 DQS 延迟下的 DQ 结果，得到一个 0-1 串，例如：<code>001111111111111111110000</code>，即随着延迟增大，先采样到 0，再采样到 1，最后又采样到 0</li>
<li>找到一个 DQS 延迟，使得 DQ 出现一个从 0 到 1 的变化，那么按照这个延迟输出，DQS 就会与 CK 同步</li>
<li>设置 SDRAM 结束 Write Leveling 模式</li>
</ol>
<h3 id="read-leveling"><a class="header" href="#read-leveling">Read Leveling</a></h3>
<p>对于读操作，数据是从 SDRAM 发送给控制器，不同的数据到达控制器的时间可能也不同，因此也需要对读操作进行校准。</p>
<p>为了判断读取的数据是否正确，做法是首先写入已知的数据，然后再读出来，如果读取的数据和写入的数据完全一致，就说明可以正确地进行读操作。</p>
<p>过程：</p>
<ol>
<li>写入数据（或者用 SDRAM 的生成固定 Pattern 输出的功能）</li>
<li>设置延迟从 0 开始循环，不断增大</li>
<li>在每个延迟的设定下，读取出数据，把读取的结果与之前写入的数据进行比较</li>
<li>统计出哪些延迟条件下，读取数据是准确的，准确的记为 1，不准确的记为 0</li>
<li>找到表示准确的 1 的范围，取中点作为最终的校准结果</li>
</ol>
<p>注意这里不再是找到 0-1 的变化的地方，Write Leveling 找 0-1 变化是为了同步，同步的地方正是 0-1 变化的地方；而 Read Leveling 的目的是要读取出正确的数据，已知有一段连续的延迟区间，区间内都可以读出正确的数据，那么取其中点，即使因为温度等条件变化，区间出现移动，因为保留了足够的余量，所以依然可以工作。取中点这一步也称为 Read Centering。</p>
<h2 id="spec"><a class="header" href="#spec">Spec</a></h2>
<p>SDRAM 相关标准由 JEDEC 制定：</p>
<ul>
<li><a href="https://www.jedec.org/standards-documents/docs/jesd-79f">JESD79F: DDR SDRAM</a></li>
<li><a href="https://www.jedec.org/sites/default/files/docs/JESD79-2F.pdf">JESD79-2F: DDR2 SDRAM</a></li>
<li><a href="https://www.jedec.org/sites/default/files/docs/JESD79-3F.pdf">JESD79-3F: DDR3 SDRAM</a></li>
<li>[JESD79-4D: DDR4 SDRAM](https://www.jedec.org/document_search?search_api_views_fulltext=jesd79-4 ddr4)</li>
<li><a href="https://www.jedec.org/document_search?search_api_views_fulltext=jesd79-5">JESD79-5B: DDR5 SDRAM</a></li>
</ul>
<p>除了 DDR 系列，还有低功耗的 LPDDR 系列：</p>
<ul>
<li><a href="https://www.jedec.org/system/files/docs/JESD209B.pdf">JESD209B: LPDDR SDRAM</a></li>
<li><a href="https://www.jedec.org/system/files/docs/JESD209-2F.pdf">JESD209-2F: LPDDR2 SDRAM</a></li>
<li><a href="https://www.jedec.org/document_search?search_api_views_fulltext=JESD209-3">JESD209-3C: LPDDR3 SDRAM</a></li>
<li><a href="https://www.jedec.org/document_search?search_api_views_fulltext=JESD209-4">JESD209-4D: LPDDR4 SDRAM</a></li>
<li><a href="https://www.jedec.org/document_search?search_api_views_fulltext=JESD209-5">JESD209-5B: LPDDR5 SDRAM</a></li>
</ul>
<p>高性能常用的 HBM 也基于 SDRAM 技术：</p>
<ul>
<li><a href="https://www.jedec.org/standards-documents/docs/jesd235a">JESD235D: HBM</a></li>
<li><a href="https://www.jedec.org/system/files/docs/JESD238A.pdf">JESD238A: HBM3</a></li>
</ul>
<p>还有 GDDR SGRAM 系列：</p>
<ul>
<li><a href="https://www.jedec.org/system/files/docs/3_11_5_8_R16.01.pdf">SDRAM3.11.5.8 R16.01: GDDR4 SGRAM</a></li>
<li><a href="https://www.jedec.org/system/files/docs/JESD212C.01.pdf">JESD212C.01: GDDR5 SGRAM</a></li>
<li><a href="https://www.jedec.org/system/files/docs/JESD232A.01.pdf">JESD232A.01: GDDR5X SGRAM</a></li>
<li><a href="https://www.jedec.org/system/files/docs/JESD250D.pdf">JESD250D: GDDR6 SGRAM</a></li>
</ul>
<p>参考：</p>
<p>https://www.cnblogs.com/sky-heaven/p/15948268.html</p>
<p><a href="https://jia.je/kb/hardware/sdram.html">Blog</a></p>
<p>https://zhuanlan.zhihu.com/p/26327347</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../01__基石篇__硬件接口与协议深度图鉴/DDR/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../01__基石篇__硬件接口与协议深度图鉴/DDR/02_DDR_MC.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../01__基石篇__硬件接口与协议深度图鉴/DDR/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../01__基石篇__硬件接口与协议深度图鉴/DDR/02_DDR_MC.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
