## FreeRTOS

[TOC]

实时性，优先级高的先做，优先级一样的交替做。

### 实时性 { .unnumbered .unlisted }

实时性主要体现在以下几个方面：

#### 1. **确定性（Determinism）** { .unnumbered .unlisted }

RTOS能够在严格规定的时间内完成任务。无论系统负载如何，RTOS都能保证任务在预定的时间内完成。这种确定性对于控制系统和安全关键应用（如航空航天、医疗设备等）至关重要。

#### 2. **低延迟（Low Latency）** { .unnumbered .unlisted }

RTOS能够迅速响应外部事件。低延迟意味着系统能够在很短的时间内从中断处理切换到任务处理，这对于需要快速反应的应用（如自动化控制、实时数据处理等）非常重要。

#### 3. **优先级调度（Priority Scheduling）** { .unnumbered .unlisted }

RTOS通常采用优先级调度算法，确保高优先级任务能够优先获得CPU资源。常见的调度算法包括优先级抢占调度（Priority Preemptive Scheduling）和循环优先级调度（Round-Robin Scheduling）。

#### 4. **中断处理（Interrupt Handling）** { .unnumbered .unlisted }

RTOS优化了中断处理机制，使得中断服务程序（ISR）能够迅速响应硬件中断并迅速切换到相应的任务。这种快速的中断处理能力使得系统能够及时响应外部事件。

#### 5. **时间管理（Time Management）** { .unnumbered .unlisted }

RTOS提供精确的时间管理功能，包括定时器和延迟机制，确保任务能够在指定时间内启动或延迟执行。这对于周期性任务和延迟任务的管理至关重要。

#### 6. **资源管理（Resource Management）** { .unnumbered .unlisted }

RTOS通过提供互斥锁、信号量、消息队列等同步机制，确保多个任务之间的资源访问不会导致竞争和冲突，从而维持系统的稳定性和实时性。

### Linux 为什么不是实时操作系统 { .unnumbered .unlisted }

详细原因：

#### 1. **内核的设计** { .unnumbered .unlisted }

* **抢占性和优先级反转问题**：虽然 Linux 支持内核抢占，但它的抢占并不完全适合实时应用。内核态的代码可能会禁用中断或锁住资源，导致高优先级任务被低优先级任务阻塞，产生优先级反转问题。
* **中断处理**：在 Linux 中，中断处理有时是不可抢占的，某些关键部分可能会长时间禁用中断，这会增加系统的响应时间。

#### 2. **调度器** { .unnumbered .unlisted }

* **调度策略**：Linux 的调度策略设计是为了公平和高效地利用 CPU 资源，而不是为了实时性。虽然 Linux 提供了实时调度类（SCHED_FIFO 和 SCHED_RR），但整体调度器并不是为确定性的实时性设计的。
* **上下文切换**：Linux 的调度器在处理上下文切换时，可能引入不可预期的延迟，无法保证实时任务在严格时间内被调度。

#### 3. **内存管理** { .unnumbered .unlisted }

* **内存分配延迟**：Linux 的内存管理子系统在分配和释放内存时，可能会引入不可预期的延迟，特别是在内存紧张时。
* **页交换（Swapping）**：Linux 使用虚拟内存和交换空间，这意味着在高负载情况下，内存页面可能会被交换到磁盘，进一步增加延迟。

#### 4. **内核锁和同步机制** { .unnumbered .unlisted }

* **锁争用**：Linux 内核中大量使用锁来保护共享资源，但在高负载或并发访问时，锁争用会增加延迟和不确定性。
* **不可中断的部分**：某些内核代码在运行时不能被中断或抢占，这会导致高优先级的实时任务不得不等待，增加延迟。

#### 5. **设备驱动** { .unnumbered .unlisted }

* **驱动模型**：Linux 的设备驱动模型并不是为实时性优化的，某些设备驱动可能会长时间占用 CPU，导致高优先级任务的延迟。
* **中断处理延迟**：设备驱动的中断处理机制可能会引入额外的延迟，无法保证及时响应硬件中断。

#### 6. **缺乏硬实时保障** { .unnumbered .unlisted }

* **软实时 vs 硬实时**：Linux 能够满足某些软实时要求（即任务通常能在规定时间内完成，但不保证每次都能完成），但不能满足硬实时要求（即任务必须在规定时间内完成）。硬实时系统需要严格的时间约束，Linux 无法提供这种保障。